<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Green Sample Processing Algorithm (GSPA) Scoring Tool</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            display: flex;
            min-height: 100vh;
            max-width: 1800px;
            margin: 0 auto;
            gap: 20px;
            padding: 20px;
        }
        
        .input-section, .visualization-section {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 25px;
            max-height: 100vh; /* Set maximum height as needed, e.g., window height */
            overflow-y: auto;
            flex: 1;
        }
        
        /* Add scrollable container */
        .input-scroll-box {
            max-height: 1000px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
        }
        
        h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
            font-size: 24px;
        }
        
        h3 {
            color: #34495e;
            margin: 20px 0 10px;
            cursor: pointer;
            display: inline-block;
            line-height: normal;
            align-items: center;
            font-size: 18px;
        }

        h3::after {
            content: '+';
            display: inline-flex;
            align-items: center;
            vertical-align: middle;
            margin-left: 8px;
            transition: transform 0.2s;
        }
        
        .input-group.active h3::after {
            content: '-';
            transform: rotate(180deg);
        }
        
        .input-content {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 8px;
        }
        
        .input-group.active .input-content {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        label {
            display: block;
            margin: 15px 0 5px;
            color: #34495e;
            font-weight: 500;
        }
        
        input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        input[type="text"]:focus, input[type="number"]:focus, select:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }
        
        .weight-adjuster {
            display: inline-flex;
            align-items: center;
            margin-left: 15px;
        }
        
        .weight-slider {
            width: 70px;
            margin: 0 10px;
            --slider-height: 4px;
            --slider-bg: #e0e0e0;
            --slider-fill: #3498db;
            --slider-thumb: #3498db;
            --slider-thumb-size: 12px;
            
            -webkit-appearance: none;
            height: var(--slider-height);
            background: var(--slider-bg);
            outline: none;
            border-radius: var(--slider-height);
            position: relative;
        }
        
        .weight-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: var(--slider-thumb-size);
            height: var(--slider-thumb-size);
            background: var(--slider-thumb);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: box-shadow 0.2s;
        }
        
        .weight-slider::-webkit-slider-thumb:hover {
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }
        
        .weight-slider::-webkit-slider-thumb:active {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
        }
        
        .weight-slider::-moz-range-thumb {
            width: var(--slider-thumb-size);
            height: var(--slider-thumb-size);
            background: var(--slider-thumb);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: box-shadow 0.2s;
            border: none;
        }
        
        .weight-slider::-moz-range-thumb:hover {
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }
        
        .weight-slider::-moz-range-thumb:active {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
        }
        
        /* Fix Firefox showing focus outline issue */
        .weight-slider:focus::-moz-range-thumb {
            outline: none;
        }
        
        .weight-value {
            min-width: 40px;
            text-align: center;
            font-weight: 500;
        }
        
        .score-display {
            font-size: 18px;
            font-weight: bold;
            margin-top: 20px;
            text-align: center;
            color: #2c3e50;
        }
        
        canvas {
            max-width: 100%;
            margin: 0 auto; /* Center horizontally */
            display: block; /* Ensure margin:0 auto works */
            margin-bottom: 10px; /* Reduce margin below radar chart */
            padding: 15px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0);
            width: 400px; /* Set radar chart width */
            height: 400px; /* Set radar chart height */
        }

        .total-score {
            font-size: 42px;
            color: #2c3e50;
            margin-top: -100px; /* Reduce margin above total score */
            text-align: center;
            font-weight: bold;
        }

        .reset-button {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 15px;
            transition: all 0.3s;
            width: 120px;
            display: block;
            margin: 25px auto 0;
            font-weight: 500;
        }

        .reset-button:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(231, 76, 60, 0.3);
        }

        .sub-indicators-container {
            max-height: 300px;
            overflow-y: auto;
            width: 100%;
            margin-top: 20px;
        }

        .sub-indicators {
            width: 100%;
            border-collapse: collapse;
        }

        .sub-indicators th, .sub-indicators td {
            border: 1px solid #e0e0e0;
            padding: 12px 15px;
            text-align: left;
        }

        .sub-indicators th {
            background-color: #f7f9fc;
            color: #2c3e50;
            font-weight: 600;
        }

        .sub-indicators tr:nth-child(even) {
            background-color: #fafbfc;
        }

        .sub-indicators tr:hover {
            background-color: #f0f4f8;
        }

        .color-block {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 8px;
            vertical-align: middle;
            border-radius: 4px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 22px;
            background-color: #3498db;
            margin-right: 12px;
            border-radius: 2px;
        }

        @media (max-width: 1200px) {
            .container {
                flex-direction: column;
            }
        }

        /* New cell style */
        .score-cell {
            padding: 10px;
            text-align: center;
            font-weight: bold;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="input-section">
            <h2>Green Sample Processing Parameters Input</h2>
            <p class="section-header">Enter parameters to evaluate the greenness of sample processing methods</p>

            <!-- Add scrollable container -->
            <div class="input-scroll-box">
                <!-- 1. Sample Collection and Preservation -->
                <div class="input-group">
                    <h3>
                        1. Sample Collection and Preservation
                        <div class="weight-adjuster">
                            <input type="range" min="0" max="100" value="12" class="weight-slider" id="w1-slider">
                            <div class="weight-value" id="w1-value">12%</div>
                        </div>
                    </h3>
                    <div class="input-content">
                        <label for="s1_1">Sample Quantity</label>
                        <input type="number" id="s1_1" placeholder="Sample Quantity">
                        <label for="s1_2">Sample Container Material</label>
                        <select id="s1_2">
                            <option value="5">Biodegradable Materials</option>
                            <option value="4">Glass (Reusable)</option>
                            <option value="3">Stainless Steel (Reusable)</option>
                            <option value="2">Recyclable Plastic</option>
                            <option value="1">Non-recyclable Plastic</option>
                        </select>
                        <label for="s1_3">Preservation Conditions</label>
                        <select id="s1_3">
                            <option value="5">Room Temperature (No Control)</option>
                            <option value="4">Refrigerated (2-8℃)</option>
                            <option value="3">Frozen (-20℃ or Below)</option>
                            <option value="2">Low Temperature and Light Protection</option>
                            <option value="1">Requires Additives</option>
                        </select>
                        <label for="s1_4">In-situ Measurement Integration</label>
                        <select id="s1_4">
                            <option value="5">In-line</option>
                            <option value="4">On-line</option>
                            <option value="3">At-line</option>
                            <option value="2">Off-line</option>
                        </select>
                    </div>
                </div>

                <!-- 2. Reagents and Solvents -->
                <div class="input-group">
                    <h3>
                        2. Reagents and Solvents
                        <div class="weight-adjuster">
                            <input type="range" min="0" max="100" value="25" class="weight-slider" id="w2-slider">
                            <div class="weight-value" id="w2-value">25%</div>
                        </div>
                    </h3>
                    <div class="input-content">
                        <label for="s2_1">Reagent Toxicity</label>
                        <select id="s2_1">
                            <option value="5">TET≤ 100</option>
                            <option value="4">100 < TET ≤ 1000</option>
                            <option value="3">1000 < TET ≤ 10000</option>
                            <option value="2">10000 < TET ≤ 100000</option>
                            <option value="1">TET > 100000</option>    
                        </select>
                        <label for="s2_2">Solvent Recyclability (%)</label>
                        <select id="s2_2">
                            <option value="5">r≥ 90%</option>
                            <option value="4">70% ≤r< 90%</option>
                            <option value="3">50% ≤r< 70%</option>
                            <option value="2">30% ≤r< 50%</option>
                            <option value="1">r< 30%</option>    
                        </select>
                        <label for="s2_3">Reagent Source</label>
                        <select id="s2_3">
                            <option value="5">Bio-based/Renewable Reagents</option>
                            <option value="3">Industrial Synthetic Reagents</option>
                            <option value="1">Heavy Metal/Halogen-containing Reagents</option>
                        </select>
                        <label for="s2_4">Single-use Quantity</label>
                        <input type="number" id="s2_4" placeholder="Single-use Quantity">
                        <label for="s2_5">Derivatization</label>
                        <select id="s2_5">
                            <option value="5">No Derivatization Steps (Direct Sample Analysis)</option>
                            <option value="3">Ambient Temperature Rapid Derivatization (≤30 minutes, Room Temperature Reaction)</option>
                            <option value="1">High Temperature/Long Time Derivatization (>60 minutes, >100℃)</option>
                        </select>
                    </div>
                </div>

                <!-- 3. Energy Consumption -->
                <div class="input-group">
                    <h3>
                        3. Energy Consumption
                        <div class="weight-adjuster">
                            <input type="range" min="0" max="100" value="15" class="weight-slider" id="w3-slider">
                            <div class="weight-value" id="w3-value">15%</div>
                        </div>
                    </h3>
                    <div class="input-content">
                        <label for="s3_1">Equipment Energy Consumption (kWh/sample)</label>
                        <select id="s3_1">
                            <option value="5">ECS≤0.1</option>
                            <option value="3">0.1< ECS ≤1.5</option>
                            <option value="1">1.5< ECS ≤3</option>
                            <option value="0">ECS>3</option>
                        </select>
                        <label for="s3_2">Temperature Control Requirements</label>
                        <select id="s3_2">
                            <option value="5">No Temperature Control Required (±5℃ Fluctuation)</option>
                            <option value="3">Moderate Temperature Control Required (≤50℃ Control)</option>
                            <option value="1">High Intensity Temperature Control Required (>50℃ or Deep Freezing)</option>
                        </select>
                        <label for="s3_3">Energy Source Type</label>
                        <select id="s3_3">
                            <option value="5">100% Renewable Energy (e.g., Solar, Wind, Hydro, Biomass)</option>
                            <option value="3">Mixed Energy (Renewable Energy and Grid Electricity)</option>
                            <option value="1">Traditional Grid Electricity (Mainly Fossil Fuel-based)</option>
                        </select>
                    </div>
                </div>

                <!-- 4. Waste Management -->
                <div class="input-group">
                    <h3>
                        4. Waste Management
                        <div class="weight-adjuster">
                            <input type="range" min="0" max="100" value="20" class="weight-slider" id="w4-slider">
                            <div class="weight-value" id="w4-value">20%</div>
                        </div>
                    </h3>
                    <div class="input-content">
                        <label for="s4_1">Total Waste Quantity</label>
                        <input type="number" id="s4_1" placeholder="Total Waste Quantity">
                        <label for="s4_2">Toxic Waste Proportion</label>
                        <input type="number" id="s4_2" placeholder="Toxic Waste Proportion">
                        <label for="s4_3">Treatment Technology</label>
                        <select id="s4_3">
                            <option value="5">Closed-loop Recycling (Full Cycle)</option>
                            <option value="4">Closed-loop Recycling (Partial Cycle)</option>
                            <option value="3">Degradation Treatment</option>
                            <option value="2">Neutralization/Passivation</option>
                            <option value="1">End-of-pipe Treatment</option>    
                        </select>
                    </div>
                </div>

                <!-- 5. Instruments and Equipment -->
                <div class="input-group">
                    <h3>
                        5. Instruments and Equipment
                        <div class="weight-adjuster">
                            <input type="range" min="0" max="100" value="10" class="weight-slider" id="w5-slider">
                            <div class="weight-value" id="w5-value">10%</div>
                        </div>
                    </h3>
                    <div class="input-content">
                        <label for="s5_1">Miniaturization</label>
                        <select id="s5_1">
                            <option value="5">Lab-on-a-Chip (Microfluidics)</option>
                            <option value="4">Portable (Handheld)</option>
                            <option value="3">Portable (Compact)</option>
                            <option value="2">Benchtop (Compact)</option>
                            <option value="1">Traditional (Large)</option>
                        </select>
                        <label for="s5_2">Equipment Lifetime and Maintenance Cost</label>
                        <select id="s5_2">
                            <option value="5">Equipment Lifetime > 10 years, Minimal Maintenance Cost</option>
                            <option value="4">Equipment Lifetime 7.5-10 years, Low Maintenance Cost</option>
                            <option value="3">Equipment Lifetime 5-7.5 years, Moderate Maintenance Cost</option>
                            <option value="2">Equipment Lifetime 3-5 years, High Maintenance Cost</option>
                            <option value="1">Equipment Lifetime < 3 years, Extremely High Maintenance Cost</option>
                        </select>
                        <label for="s5_3">Compatibility</label>
                        <select id="s5_3">
                            <option value="5">Multi-module Integration</option>
                            <option value="3">Single-function</option>
                            <option value="1">Requires External Equipment</option>
                        </select>
                    </div>
                </div>

                <!-- 6. Operational Workflow -->
                <div class="input-group">
                    <h3>
                        6. Operational Workflow
                        <div class="weight-adjuster">
                            <input type="range" min="0" max="100" value="10" class="weight-slider" id="w6-slider">
                            <div class="weight-value" id="w6-value">10%</div>
                        </div>
                    </h3>
                    <div class="input-content">
                        <label for="s6_1">Number of Steps</label>
                        <select id="s6_1">
                            <option value="5">s≤3</option>
                            <option value="4">s=4</option>
                            <option value="3">s=5</option>
                            <option value="2">s=6</option>
                            <option value="1">s=7</option>
                            <option value="0">s≥8</option>
                        </select>
                        <label for="s6_2">Degree of Automation</label>
                        <select id="s6_2">
                            <option value="5">Fully Automatic (No Human Intervention)</option>
                            <option value="4">Highly Automated</option>
                            <option value="3">Semi-automated</option>
                            <option value="2">Assisted Automation</option>
                            <option value="1">Fully Manual</option>
                        </select>
                        <label for="s6_3">Sample Throughput</label>
                        <input type="number" id="s6_3" placeholder="Sample Throughput">
                    </div>
                </div>

                <!-- 7. Data Analysis and Validation -->
                <div class="input-group">
                    <h3>
                        7. Data Analysis and Validation
                        <div class="weight-adjuster">
                            <input type="range" min="0" max="100" value="5" class="weight-slider" id="w7-slider">
                            <div class="weight-value" id="w7-value">5%</div>
                        </div>
                    </h3>
                    <div class="input-content">
                        <label for="s7_1">Data Sharing Transparency</label>
                        <select id="s7_1">
                            <option value="5">Open Source Database</option>
                            <option value="3">Partially Open Database</option>
                            <option value="1">Non-public Database</option>
                        </select>
                        <label for="s7_2">Method Validation</label>
                        <select id="s7_2">
                            <option value="5">Fully Validated</option>
                            <option value="3">Partially Validated</option>
                            <option value="1">Not Validated</option>
                        </select>
                        <label for="s7_3">Computational Tools</label>
                        <select id="s7_3">
                            <option value="5">Low-carbon Algorithms</option>
                            <option value="3">Traditional Computing</option>
                            <option value="1">High-energy Models</option>
                        </select>
                    </div>
                </div>

                <!-- 8. Safety and Efficiency -->
                <div class="input-group">
                    <h3>
                        8. Safety and Efficiency
                        <div class="weight-adjuster">
                            <input type="range" min="0" max="100" value="3" class="weight-slider" id="w8-slider">
                            <div class="weight-value" id="w8-value">3%</div>
                        </div>
                    </h3>
                    <div class="input-content">
                        <label for="s8_1">Operator Safety</label>
                        <select id="s8_1">
                            <option value="5">No Protective Measures Required</option>
                            <option value="3">Gloves, Lab Coat and Other Level 1 Protective Equipment Required</option>
                            <option value="1">Gas Masks, Protective Suits and Other Special Protective Equipment Required</option>
                        </select>
                        <label for="s8_2">Cost per Sample Analysis</label>
                        <input type="number" id="s8_2" placeholder="Cost per Sample Analysis">
                    </div>
                </div>
            </div>

            <!-- Reset Button -->
            <button class="reset-button" id="reset-button">Reset</button>
        </div>

        <div class="visualization-section">
            <h2>Greenness Evaluation</h2>
            <canvas id="radar-chart"></canvas>
            <div class="total-score" id="total-score">0</div>
            <!-- Sub-indicator scoring and color table -->
            <h3>Sub-indicator Scoring</h3>
            <div class="sub-indicators-container">
                <table class="sub-indicators" id="sub-indicators">
                    <thead>
                        <tr>
                            <th>Indicator</th>
                            <th>Score</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Initialize radar chart
        const radarCtx = document.getElementById('radar-chart').getContext('2d');
        const radarChart = new Chart(radarCtx, {
            type: 'radar',
            data: {
                labels: [
                    'Sample Collection and Preservation',
                    'Reagents and Solvents',
                    'Energy Consumption',
                    'Waste Management',
                    'Instruments and Equipment',
                    'Operational Workflow',
                    'Data Analysis and Validation',
                    'Safety and Efficiency'
                ],
                datasets: [{
                    label: 'Score',
                    data: [0, 0, 0, 0, 0, 0, 0, 0],
                    backgroundColor: 'rgba(0, 153, 68, 0.2)',
                    borderColor: 'rgba(0, 153, 68, 1)',
                    pointBackgroundColor: ['#e60012', '#e60012', '#e60012', '#e60012', '#e60012', '#e60012', '#e60012', '#e60012'],
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: ['#e60012', '#e60012', '#e60012', '#e60012', '#e60012', '#e60012', '#e60012', '#e60012'],
                    pointHoverBorderColor: 'rgba(0, 153, 68, 1)'
                }]
            },
            options: {
                elements: {
                    line: {
                        tension: 0.1
                    }
                },
                scales: {
                    r: {
                        angleLines: {
                            display: true
                        },
                        suggestedMin: 0,
                        suggestedMax: 5,
                        ticks: {
                            display: false
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        }
                    }
                }
            }
        });

        // Calculate color
        function calculateColor(score, isTotalScore = false) {
            if (isTotalScore) {
                if (score >= 4) {
                    return {
                        backgroundColor: 'rgba(0, 153, 68, 0.2)',
                        borderColor: 'rgba(0, 153, 68, 1)'
                    };
                } else if (score >= 3) {
                    return {
                        backgroundColor: 'rgba(143, 195, 31, 0.2)',
                        borderColor: 'rgba(143, 195, 31, 1)'
                    };
                } else if (score >= 2) {
                    return {
                        backgroundColor: 'rgba(255, 241, 0, 0.2)',
                        borderColor: 'rgba(255, 241, 0, 1)'
                    };
                } else if (score >= 1) {
                    return {
                        backgroundColor: 'rgba(243, 152, 0, 0.2)',
                        borderColor: 'rgba(243, 152, 0, 1)'
                    };
                } else {
                    return {
                        backgroundColor: 'rgba(230, 0, 18, 0.2)',
                        borderColor: 'rgba(230, 0, 18, 1)'
                    };
                }
            } else {
                if (score >= 4) {
                    return '#009944';  // 5-4.0: Green
                } else if (score >= 3) {
                    return '#8fc31f';  // 4-3: Light Green
                } else if (score >= 2) {
                    return '#fff100';  // 3-2: Yellow
                } else if (score >= 1) {
                    return '#f39800';  // 2-1: Orange
                } else {
                    return '#e60012';  // 1-0: Red
                }
            }
        }

        // Update sub-indicator table
        function updateSubIndicatorsTable(metrics) {
            const tbody = document.querySelector('#sub-indicators tbody');
            tbody.innerHTML = '';

            metrics.forEach(metric => {
                const row = document.createElement('tr');
                
                const nameCell = document.createElement('td');
                nameCell.textContent = metric.name;
                row.appendChild(nameCell);
                
                const combinedCell = document.createElement('td');
                combinedCell.className = 'score-cell';
                
                // Set cell background color
                const scoreColor = calculateColor(metric.score, false);
                combinedCell.style.backgroundColor = scoreColor;
                
                // Set cell content
                combinedCell.textContent = metric.score.toFixed(2);
                row.appendChild(combinedCell);
                
                tbody.appendChild(row);
            });
        }

        // Calculate total score
        function calculateScore() {
            const categoryWeights = [
                parseFloat(document.getElementById('w1-value').textContent) / 100,
                parseFloat(document.getElementById('w2-value').textContent) / 100,
                parseFloat(document.getElementById('w3-value').textContent) / 100,
                parseFloat(document.getElementById('w4-value').textContent) / 100,
                parseFloat(document.getElementById('w5-value').textContent) / 100,
                parseFloat(document.getElementById('w6-value').textContent) / 100,
                parseFloat(document.getElementById('w7-value').textContent) / 100,
                parseFloat(document.getElementById('w8-value').textContent) / 100
            ];

            const categories = [
                {
                    id: 1,
                    weight: categoryWeights[0],
                    metrics: [
                        { id: 1, weight: 0.25, input: 's1_1', type: 'volume', name: 'Sample Quantity' },
                        { id: 2, weight: 0.20, input: 's1_2', type: 'select', name: 'Sample Container Material' },
                        { id: 3, weight: 0.20, input: 's1_3', type: 'select', name: 'Preservation Conditions' },
                        { id: 4, weight: 0.35, input: 's1_4', type: 'select', name: 'In-situ Measurement Integration' }
                    ]
                },
                {
                    id: 2,
                    weight: categoryWeights[1],
                    metrics: [
                        { id: 1, weight: 0.25, input: 's2_1', type: 'select', name: 'Reagent Toxicity' },
                        { id: 2, weight: 0.20, input: 's2_2', type: 'recycle', name: 'Solvent Recyclability' },
                        { id: 3, weight: 0.15, input: 's2_3', type: 'select', name: 'Reagent Source' },
                        { id: 4, weight: 0.25, input: 's2_4', type: 'usage', name: 'Single-use Quantity' },
                        { id: 5, weight: 0.15, input: 's2_5', type: 'select', name: 'Derivatization' }
                    ]
                },
                {
                    id: 3,
                    weight: categoryWeights[2],
                    metrics: [
                        { id: 1, weight: 0.40, input: 's3_1', type: 'energy', name: 'Equipment Energy Consumption' },
                        { id: 2, weight: 0.30, input: 's3_2', type: 'select', name: 'Temperature Control Requirements' },
                        { id: 3, weight: 0.30, input: 's3_3', type: 'renewable', name: 'Energy Source Type' }
                    ]
                },
                {
                    id: 4,
                    weight: categoryWeights[3],
                    metrics: [
                        { id: 1, weight: 0.35, input: 's4_1', type: 'waste', name: 'Total Waste Quantity' },
                        { id: 2, weight: 0.30, input: 's4_2', type: 'toxic', name: 'Toxic Waste Proportion' },
                        { id: 3, weight: 0.35, input: 's4_3', type: 'select', name: 'Treatment Technology' }
                    ]
                },
                {
                    id: 5,
                    weight: categoryWeights[4],
                    metrics: [
                        { id: 1, weight: 0.40, input: 's5_1', type: 'select', name: 'Miniaturization' },
                        { id: 2, weight: 0.30, input: 's5_2', type: 'select', name: 'Equipment Lifetime and Maintenance Cost' },
                        { id: 3, weight: 0.30, input: 's5_3', type: 'select', name: 'Compatibility' }
                    ]
                },
                {
                    id: 6,
                    weight: categoryWeights[5],
                    metrics: [
                        { id: 1, weight: 0.35, input: 's6_1', type: 'steps', name: 'Number of Steps' },
                        { id: 2, weight: 0.30, input: 's6_2', type: 'select', name: 'Degree of Automation' },
                        { id: 3, weight: 0.35, input: 's6_3', type: 'batch', name: 'Sample Throughput' }
                    ]
                },
                {
                    id: 7,
                    weight: categoryWeights[6],
                    metrics: [
                        { id: 1, weight: 0.40, input: 's7_1', type: 'select', name: 'Data Sharing Transparency' },
                        { id: 2, weight: 0.30, input: 's7_2', type: 'select', name: 'Method Validation' },
                        { id: 3, weight: 0.30, input: 's7_3', type: 'select', name: 'Computational Tools' }
                    ]
                },
                {
                    id: 8,
                    weight: categoryWeights[7],
                    metrics: [
                        { id: 1, weight: 0.50, input: 's8_1', type: 'select', name: 'Operator Safety' },
                        { id: 2, weight: 0.50, input: 's8_2', type: 'cost', name: 'Cost per Sample Analysis' }
                    ]
                }
            ];

            let totalScore = 0;
            const categoryScores = [];
            const subMetrics = [];  // Store sub-indicator scoring and color

            categories.forEach(category => {
                let categoryScore = 0;
                category.metrics.forEach(metric => {
                    const input = document.getElementById(metric.input);
                    let value = input.value;

                    switch (metric.type) {
                        case 'volume':
                            value = parseFloat(value) || 0;
                            if (value <= 1) {
                                value = 5;
                            } else if (value < 100) {
                                value = 5 * (1 - Math.pow(Math.log(value) / Math.log(100), 1.3219));
                            } else {
                                value = 0;
                            }
                            value = Math.min(5, Math.max(0, value));
                            break;
                        case 'usage':
                            value = parseFloat(value) || 0;
                            if (value <= 0.1) {
                                value = 5;
                            } else if (value <= 1) {
                                value = 5 * Math.exp(-2 * (value - 0.1));
                            } else if (value <= 10) {
                                value = (5 * Math.exp(-1.8)) / (Math.log10(value) + 1);
                            } else if (value <= 100) {
                                value = (5 * Math.exp(-1.8) / 2) * (1 - (value - 10) / 90);
                            } else {
                                value = 0;
                            }
                            value = Math.min(5, Math.max(0, value));
                            break;
                        case 'waste':
                            value = parseFloat(value) || 0;
                            if (value <= 1) {
                                value = 5;
                            } else if (value <= 10) {
                                value = -3 * Math.log10(value) + 5;
                            } else if (value <= 30) {
                                value = -0.1 * value + 3;
                            } else {
                                value = 0;
                            }
                            value = Math.min(5, Math.max(0, value));
                            break;
                        case 'toxic':
                            value = parseFloat(value) || 0;
                            if (value <= 10) {
                                value = 5 - 0.2 * value;
                            } else if (value <= 100) {
                                value = 3 - (3 / Math.log(10)) * Math.log(value / 10);
                            } else {
                                value = 0;
                            }
                            value = Math.min(5, Math.max(0, value));
                            break;    
                        case 'batch':
                            value = parseFloat(value) || 0;
                            if (value === 0) {
                                value = 0;
                            } else if (value < 96) {
                                const lnTerm = Math.log(1 + value) / Math.log(97);
                                const sinTerm = Math.pow(Math.sin((Math.PI / 2) * (value / 96)), 2);
                                value = 5 * lnTerm * sinTerm;
                            } else {
                                value = 5;
                            }
                            value = Math.min(5, Math.max(0, value));
                            break;
                        case 'cost':
                            value = parseFloat(value) || 0;
                            if (value <= 1) {
                                value = 5;
                            } else if (value <= 10) {
                                value = 5 - (2 / Math.log(10)) * Math.log(value);
                            } else if (value <= 100) {
                                value = 6 - (3 / Math.log(10)) * Math.log(value);
                            } else {
                                value = 0;
                            }
                            value = Math.min(5, Math.max(0, value));
                            break;
                        case 'select':
                            value = parseFloat(value) || 0;
                            value = Math.min(5, Math.max(0, value));
                            break;
                        default:
                            value = parseFloat(value) || 0;
                            value = Math.min(5, Math.max(0, value));
                    }

                    const partScore = value * metric.weight;
                    categoryScore += partScore;

                    // Store sub-indicator scoring and name
                    subMetrics.push({
                        name: metric.name,
                        score: value
                    });
                });

                categoryScore *= category.weight;
                totalScore += categoryScore;
                categoryScores.push(categoryScore / category.weight); // Normalized score
            });

            // Update total score display
            document.getElementById('total-score').textContent = totalScore.toFixed(2);

            // Update radar chart
            radarChart.data.datasets[0].data = categoryScores;

            // Calculate color
            const color = calculateColor(totalScore, true);
            radarChart.data.datasets[0].backgroundColor = color.backgroundColor;
            radarChart.data.datasets[0].borderColor = color.borderColor;
            radarChart.data.datasets[0].pointBackgroundColor = categoryScores.map(score => calculateColor(score, false));  // Point colors
            radarChart.data.datasets[0].pointHoverBackgroundColor = categoryScores.map(score => calculateColor(score, false));  // Point hover colors

            radarChart.update();

            // Update sub-indicator table
            updateSubIndicatorsTable(subMetrics);
        }

        // Initialize weight sliders
        function initializeWeightSliders() {
            const weightSliders = document.querySelectorAll('.weight-slider');
            
            weightSliders.forEach(slider => {
                const id = slider.id;
                const valueDisplay = document.getElementById(id.replace('-slider', '-value'));
                
                slider.addEventListener('input', function() {
                    const value = this.value;
                    valueDisplay.textContent = value + '%';
                    calculateScore();
                });
            });
        }

        // Reset button functionality
        document.getElementById('reset-button').addEventListener('click', function() {
            // Reset all input fields
            document.querySelectorAll('input, select').forEach(element => {
                if (element.type === 'number') {
                    element.value = '';
                } else if (element.tagName === 'SELECT') {
                    element.selectedIndex = 0;
                } else if (element.type === 'text' || element.type === 'number') {
                    element.value = '';
                }
            });

            // Reset weight sliders to default values
            document.getElementById('w1-slider').value = 12;
            document.getElementById('w1-value').textContent = '12%';
            document.getElementById('w2-slider').value = 25;
            document.getElementById('w2-value').textContent = '25%';
            document.getElementById('w3-slider').value = 15;
            document.getElementById('w3-value').textContent = '15%';
            document.getElementById('w4-slider').value = 20;
            document.getElementById('w4-value').textContent = '20%';
            document.getElementById('w5-slider').value = 10;
            document.getElementById('w5-value').textContent = '10%';
            document.getElementById('w6-slider').value = 10;
            document.getElementById('w6-value').textContent = '10%';
            document.getElementById('w7-slider').value = 5;
            document.getElementById('w7-value').textContent = '5%';
            document.getElementById('w8-slider').value = 3;
            document.getElementById('w8-value').textContent = '3%';

            // Reset radar chart
            radarChart.data.datasets[0].data = [0, 0, 0, 0, 0, 0, 0, 0];
            radarChart.data.datasets[0].backgroundColor = 'rgba(0, 153, 68, 0.2)';
            radarChart.data.datasets[0].borderColor = 'rgba(0, 153, 68, 1)';
            radarChart.data.datasets[0].pointBackgroundColor = ['#e60012', '#e60012', '#e60012', '#e60012', '#e60012', '#e60012', '#e60012', '#e60012'];
            radarChart.data.datasets[0].pointHoverBackgroundColor = ['#e60012', '#e60012', '#e60012', '#e60012', '#e60012', '#e60012', '#e60012', '#e60012'];
            radarChart.update();

            // Reset total score display
            document.getElementById('total-score').textContent = '0';

            // Reset sub-indicator table
            document.querySelector('#sub-indicators tbody').innerHTML = '';
        });

        // Expand/collapse input groups
        document.querySelectorAll('.input-group h3').forEach(header => {
            header.addEventListener('click', function () {
                const group = this.parentNode;
                group.classList.toggle('active');
            });
        });

        // Listen for input changes
        document.querySelectorAll('input, select').forEach(input => {
            input.addEventListener('input', calculateScore);
        });

        // Initialize application
        window.addEventListener('load', function() {
            initializeWeightSliders();
            calculateScore();
        });
    </script>
</body>
</html>